"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.run=void 0;const stop_discord_phishing_1=require("stop-discord-phishing"),counting_1=__importDefault(require("../handlers/counting")),bot_1=require("../bot"),utils_1=require("../handlers/utils"),Util_1=__importDefault(require("../util/Util"));async function run(t){if(!t.guild||t.author.bot||"DM"===t.channel.type||"dob-flow-editor"===t.channel.name)return;const e=await Util_1.default.database.guild(t.guild.id);if((await Util_1.default.database.settings(t.guild.id)).get().detectScamLinks&&await(0,stop_discord_phishing_1.checkMessage)(t.content,!0)){let e=bot_1.linkRates.get(t.guild.id);return e.has(t.author.id)||(await t.channel.send(`${t.author}, Ð² Ð²Ð°ÑˆÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸ Ð±Ñ‹Ð»Ð° Ð·Ð°Ð¼ÐµÑ‡ÐµÐ½Ð° Ð²Ñ€ÐµÐ´Ð¾Ð½Ð¾ÑÐ½Ð°Ñ ÑÑÑ‹Ð»ÐºÐ°. Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ `+(t.deletable?"Ð±ÑƒÐ´ÐµÑ‚ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¾.":"Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¾, Ñ‚Ð°Ðº ÐºÐ°Ðº Ñƒ Ð¼ÐµÐ½Ñ Ð½ÐµÑ‚ Ð¿Ñ€Ð°Ð² Ð½Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð² ÑÑ‚Ð¾Ð¼ ÐºÐ°Ð½Ð°Ð»Ðµ.")).then((t=>setTimeout((()=>(0,utils_1.deleteMessage)(t)),1e4))),e.add(t.author.id),setTimeout((()=>e.delete(t.author.id)),5e3)),bot_1.linkRates.set(t.guild.id,e),(0,utils_1.deleteMessage)(t)}const{channel:i}=e.get();return i===t.channel.id?await(0,counting_1.default)(t):t.content.match(`^<@!?${Util_1.default.client.user.id}>`)?await t.react("ðŸ‘‹").catch((()=>null)):void 0}exports.run=run;