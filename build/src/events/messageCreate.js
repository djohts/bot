"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.run=void 0;const stop_discord_phishing_1=require("stop-discord-phishing"),handler_1=__importDefault(require("../handlers/counting/handler")),bot_1=require("../bot"),utils_1=require("../handlers/utils"),Util_1=__importDefault(require("../util/Util"));async function run(e){if(!e.guild||e.author.bot||"DM"===e.channel.type||"dob-flow-editor"===e.channel.name)return;const t=await Util_1.default.database.guild(e.guild.id);if((await Util_1.default.database.settings(e.guild.id)).get().detectScamLinks&&await(0,stop_discord_phishing_1.checkMessage)(e.content,!0)){let t=bot_1.linkRates.get(e.guild.id);return t.has(e.author.id)||(await e.channel.send(`${e.author}, Ğ² Ğ²Ğ°ÑˆĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ Ğ±Ñ‹Ğ»Ğ° Ğ·Ğ°Ğ¼ĞµÑ‡ĞµĞ½Ğ° Ğ²Ñ€ĞµĞ´Ğ¾Ğ½Ğ¾ÑĞ½Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ°. Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ `+(e.deletable?"Ğ±ÑƒĞ´ĞµÑ‚ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¾.":"Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¾, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ñƒ Ğ¼ĞµĞ½Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ² ÑÑ‚Ğ¾Ğ¼ ĞºĞ°Ğ½Ğ°Ğ»Ğµ.")).then((e=>setTimeout((()=>(0,utils_1.deleteMessage)(e)),1e4))),t.add(e.author.id),setTimeout((()=>t.delete(e.author.id)),5e3)),bot_1.linkRates.set(e.guild.id,t),(0,utils_1.deleteMessage)(e)}const{channel:i}=t.get();return i===e.channel.id?await(0,handler_1.default)(e):e.content.match(`^<@!?${Util_1.default.client.user.id}>`)?await e.react("ğŸ‘‹").catch((()=>null)):void 0}exports.run=run;