"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.flowWalkthrough=exports.formatExplanation=void 0;const flow_1=require("./flow"),_1=__importDefault(require("./"));async function formatExplanation({type:t,data:e}){let{properties:i,explanation:a}=flow_1.flow.triggers[t]||flow_1.flow.actions[t];for(const t in i)a=a.replace(`{${t}}`,await i[t].format(e[t]));return a}exports.formatExplanation=formatExplanation;const allActionTypes=Object.keys(flow_1.flow.actions),allActions=Object.values(flow_1.flow.actions),allTriggerTypes=Object.keys(flow_1.flow.triggers),allTriggers=Object.values(flow_1.flow.triggers);async function flowWalkthrough(t,e,i,a,s,n){for(;a.triggers.length<_1.default.limitTriggers;)a.triggers.push(null);for(;a.actions.length<_1.default.limitActions;)a.actions.push(null);let o=!0,r=!1;for(;o;)try{await n.edit({content:null,embeds:[await s()]});const l=(await i.awaitMessages({filter:t=>t.author.id==e.id,max:1,time:12e4,errors:["time"]})).first(),p=[l],m=l?.content.split(" "),d=m?.shift().toLowerCase();if("edit"==d&&["trigger","action"].includes(m[0])&&parseInt(m[1])){const s=parseInt(m[1]);if("trigger"==m[0])if(s>_1.default.limitTriggers)p.push(await i.send(`âŒ Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¸Ð¼ÐµÑ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ${_1.default.limitTriggers} Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð°(-Ð¾Ð²) Ð½Ð° Ð¿Ð¾Ñ‚Ð¾Ðº.`));else{p.push(await i.send({embeds:[{title:`ðŸ“ Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€ Ð½Ð° ÑÐ»Ð¾Ñ‚ ${s}`,description:"0 - **ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ**\n\n"+allTriggers.map(((t,e)=>`${e+1} - **${t.short}**${t.long?`\n${t.long}`:""}`)).join("\n\n"),timestamp:Date.now()}]}));const n=(await i.awaitMessages({filter:t=>t.author.id==e.id,max:1,time:12e4,errors:["time"]})).first(),o=parseInt(n.content);if(p.push(n),0==o)a.triggers[s-1]=null,p.push(await i.send({embeds:[{title:`âœ… Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€ ${s} Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½!`,timestamp:Date.now()}]}));else if(!o||o>allTriggerTypes.length)p.push(await i.send("âœ´ï¸ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€. ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½Ð¾."));else{let n=allTriggers[o-1],r={type:allTriggerTypes[o-1],data:[]};for(const a of n.properties){p.push(await i.send({embeds:[{title:`âœï¸ Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ ${a.short}`,description:a.help||void 0,timestamp:Date.now()}]}));const s=(await i.awaitMessages({filter:t=>t.author.id==e.id,max:1,time:12e4,errors:["time"]})).first(),n=await a.convert(s.content,{guild:t});if(p.push(s),null==n){p.push(await i.send({embeds:[{title:"âŒ ÐÐµÐ²ÐµÑ€Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ. Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð° Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½Ð¾.",timestamp:Date.now()}]}));break}r.data.push(n)}if(r.data.length==n.properties.length){p.push(await i.send({embeds:[{title:`ðŸ’¨ ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ðµ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€ ${s}`,description:["**Ð­Ñ‚Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾? ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ `Ð´Ð°` Ð¸Ð»Ð¸ `Ð½ÐµÑ‚`.**",`${(await formatExplanation(r)).split("\n").map((t=>`> ${t}`)).join("\n")}`].join("\n"),timestamp:Date.now()}]}));const t=(await i.awaitMessages({filter:t=>t.author.id==e.id,max:1,time:12e4,errors:["time"]})).first(),n="Ð´Ð°"==t.content.toLowerCase();p.push(t),n?(a.triggers[s-1]=r,p.push(await i.send({embeds:[{title:`âœ… Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€ ${s} Ð±Ñ‹Ð» Ð¸Ð·Ð¼ÐµÐ½Ñ‘Ð½!`,timestamp:Date.now()}]}))):p.push(await i.send({embeds:[{title:`âœ´ï¸ Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð° ${s} Ð±Ñ‹Ð»Ð¾ Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½Ð¾.`,timestamp:Date.now()}]}))}}}else if(s>_1.default.limitActions)p.push(await i.send(`âŒ Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¸Ð¼ÐµÑ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ${_1.default.limitActions} Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ(-Ð¸Ð¹) Ð½Ð° Ð¿Ð¾Ñ‚Ð¾Ðº.`));else{p.push(await i.send({embeds:[{title:`ðŸ“ Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð½Ð° ÑÐ»Ð¾Ñ‚ ${s}`,description:"0 - **ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ**\n\n"+allActions.map(((t,e)=>`${e+1} - **${t.short}**${t.long?`\n${t.long}`:""}`)).join("\n\n"),timestamp:Date.now()}]}));const n=(await i.awaitMessages({filter:t=>t.author.id==e.id,max:1,time:12e4,errors:["time"]})).first(),o=parseInt(n.content);if(p.push(n),0==o)a.actions[s-1]=null,p.push(await i.send({embeds:[{title:`âœ… Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ ${s} Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ð¾!`,timestamp:Date.now()}]}));else if(!o||o>allActionTypes.length)p.push(await i.send("âœ´ï¸ ÐÐµÐ²ÐµÑ€Ð½Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ. ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½Ð¾."));else{let n=allActions[o-1],r={type:allActionTypes[o-1],data:[]};for(const a of n.properties){p.push(await i.send({embeds:[{title:`âœï¸ Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ ${a.short}`,description:a.help||void 0,timestamp:Date.now()}]}));const s=(await i.awaitMessages({filter:t=>t.author.id==e.id,max:1,time:12e4,errors:["time"]})).first(),n=await a.convert(s.content,{guild:t});if(p.push(s),null==n){p.push(await i.send({embeds:[{title:"âŒ ÐÐµÐ²ÐµÑ€Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ. Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½Ð¾.",timestamp:Date.now()}]}));break}r.data.push(n)}if(r.data.length==n.properties.length){p.push(await i.send({embeds:[{title:`ðŸ’¨ ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ ${s}`,description:["**Ð­Ñ‚Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾? ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ `Ð´Ð°` Ð¸Ð»Ð¸ `Ð½ÐµÑ‚`.**",`${(await formatExplanation(r)).split("\n").map((t=>`> ${t}`)).join("\n")}`].join("\n"),timestamp:Date.now()}]}));const t=(await i.awaitMessages({filter:t=>t.author.id==e.id,max:1,time:12e4,errors:["time"]})).first(),n="Ð´Ð°"==t.content.toLowerCase();p.push(t),n?(a.actions[s-1]=r,p.push(await i.send({embeds:[{title:`âœ… Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ ${s} Ð±Ñ‹Ð»Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¾!`,timestamp:Date.now()}]}))):p.push(await i.send({embeds:[{title:`âœ´ï¸ Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ ${s} Ð±Ñ‹Ð»Ð¾ Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½Ð¾.`,timestamp:Date.now()}]}))}}}}else"save"==d?a.triggers.find((t=>t))&&a.actions.find((t=>t))?(o=!1,r=!0):p.push(await i.send("âŒ Ð’Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ ÐºÐ°Ðº Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ Ð¾Ð´Ð¸Ð½ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€ Ð¸ Ð¾Ð´Ð½Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ!")):"cancel"==d?o=!1:["help","?"].includes(d)?p.push(await i.send(`ðŸ”— ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð·Ð°ÐºÑ€ÐµÐ¿Ð»Ñ‘Ð½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸! ${n.url}`)):p.push(await i.send("âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ. ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ Ð·Ð°ÐºÑ€ÐµÐ¿Ð»Ñ‘Ð½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸!"));o&&setTimeout((async()=>await i.bulkDelete(p).catch((()=>null))),5e3)}catch(t){o=!1}return r}exports.flowWalkthrough=flowWalkthrough;